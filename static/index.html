<html>
  <head>
    <title>Demo</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link rel="stylesheet" href="css/bpd-core.css" />
    <style>
      html,
      body {
        padding: 0px;
        margin: 0px;
      }

      .createNode-box1 {
        position: fixed;
        bottom: 20px;
        left: 20px;
      }

      .createNode-box2 {
        position: fixed;
        bottom: 50px;
        left: 20px;
      }

      .createNode-box3 {
        position: fixed;
        bottom: 80px;
        left: 20px;
      }
      .createNode-box4 {
        position: fixed;
        bottom: 110px;
        left: 20px;
      }
      .other1 {
        position: fixed;
        bottom: 140px;
        left: 20px;
      }
      .other2 {
        position: fixed;
        bottom: 170px;
        left: 20px;
      }
    </style>
  </head>

  <body>
    <div id="canvas"></div>

    <span class="createNode-box1">
      <button class="createNode" draggable="true" shapeName="startEvent">
        StartEvent
      </button>
    </span>
    <span class="createNode-box2">
      <button class="createNode" draggable="true" shapeName="userTask">
        UserTask
      </button>
      <button class="createNode" draggable="true" shapeName="serviceTask">
        ServiceTask
      </button>
      <button class="createNode" draggable="true" shapeName="CallActivity">
        CallActivity
      </button>
    </span>
    <span class="createNode-box3">
      <button class="createNode" draggable="true" shapeName="exclusiveGateway">
        ExclusiveGateway
      </button>
      <button class="createNode" draggable="true" shapeName="inclusiveGateway">
        InclusiveGateway
      </button>
      <button class="createNode" draggable="true" shapeName="complexGateway">
        ComplexGateway
      </button>
      <button class="createNode" draggable="true" shapeName="parallelGateway">
        ParallelGateway
      </button>
    </span>
    <span class="createNode-box4">
      <button class="createNode" draggable="true" shapeName="endEvent">
        EndEvent
      </button>
      <button class="createNode" draggable="true" shapeName="terminateEndEvent">
        TerminateEndEvent
      </button>
    </span>
    <span class="other1">
      <button class="new">new</button> <button class="init">init</button>
      <button class="update">update</button>
      <button class="toXML">toXML</button>
      <button class="getFronts">fronts</button>
      <button class="getFront">front</button>
      <button class="destroy">destroy</button>
      <button class="multiselect">multiselect</button>
    </span>
    <span class="other2"> <input class="importXML" type="file" /> </span>

    <script type="text/javascript" src="jquery-1.8.3.min.js"></script>
    <script src="extensions.js"></script>
    <script src="js/bpd-core.js"></script>
    <script>
      var testBPD = null
      var selectElement = null
      window.onload = function() {
        testBPD = new BPDCore({
          container: '#canvas',
          definition:
            '<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:do1="http://do1.com.cn/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" targetNamespace="http://bpmn.io/schema/bpmn"><bpmn:process id="process_01"><bpmn:extensionElements><do1:cancelTask>false</do1:cancelTask><do1:cancelProcess>false</do1:cancelProcess><do1:clearHistoryWhenCancelProcess>false</do1:clearHistoryWhenCancelProcess><do1:cancelProcessExclusiveNode>[]</do1:cancelProcessExclusiveNode><do1:defaultTitle>false</do1:defaultTitle><do1:title></do1:title><do1:relatedFormId></do1:relatedFormId><do1:description></do1:description></bpmn:extensionElements><bpmn:startEvent id="obj_01" name="开始事件"><bpmn:extensionElements /><bpmn:outgoing>obj_05</bpmn:outgoing></bpmn:startEvent><bpmn:userTask id="obj_02" name="人工任务"><bpmn:extensionElements><do1:description /><do1:showHistoricalRecord>false</do1:showHistoricalRecord><do1:operation>{"executeOperation":{"enabled":true,"buttonLabel":"提交"},"rejectOperation":{"enabled":true,"buttonLabel":"驳回"},"circularizeOperation":{"enabled":true,"buttonLabel":"传阅"},"agentOperation":{"enabled":true,"buttonLabel":"委托"},"terminateOperation":{"enabled":true,"buttonLabel":"终止"},"printOperation":{"enabled":false,"buttonLabel":"打印"},"signatureOperation":{"enabled":true,"buttonLabel":"加签"}}</do1:operation><do1:multiInstanceControl>{"method":"or","enabled":false,"taskCompletionRate":"100"}</do1:multiInstanceControl><do1:defaultCarbonCopy>{"enabled":false,"userIds":[]}</do1:defaultCarbonCopy><do1:condition type="initiatorRelateUsers">{"initiatorRelate":"0","findUpperSuperiorWhenMissSuperior":false}</do1:condition><do1:notification>{"channelList":["wbg","portal"]}</do1:notification><do1:formEditPermissions>{"formId":"5caeec21e7283d50e5622691","web":[],"mobile":[]}</do1:formEditPermissions><do1:actionWithoutHandler>{"transferMode":"enterNextNode"}</do1:actionWithoutHandler></bpmn:extensionElements><bpmn:incoming>obj_05</bpmn:incoming><bpmn:outgoing>obj_06</bpmn:outgoing></bpmn:userTask><bpmn:userTask id="obj_03" name="人工任务"><bpmn:extensionElements><do1:description /><do1:showHistoricalRecord>false</do1:showHistoricalRecord><do1:operation>{"executeOperation":{"enabled":true,"buttonLabel":"办理"},"rejectOperation":{"enabled":true,"buttonLabel":"驳回"},"circularizeOperation":{"enabled":true,"buttonLabel":"传阅"},"agentOperation":{"enabled":true,"buttonLabel":"委托"},"terminateOperation":{"enabled":true,"buttonLabel":"终止"},"printOperation":{"enabled":false,"buttonLabel":"打印"},"signatureOperation":{"enabled":true,"buttonLabel":"加签"}}</do1:operation><do1:multiInstanceControl>{"method":"or","enabled":false,"taskCompletionRate":"100"}</do1:multiInstanceControl><do1:defaultCarbonCopy>{"enabled":false,"userIds":[]}</do1:defaultCarbonCopy><do1:condition type="designatedUser">{"designatedUser":"true"}</do1:condition><do1:notification>{"channelList":["wbg","portal"]}</do1:notification><do1:formEditPermissions>{"formId":"5caeec21e7283d50e5622691","web":[],"mobile":[]}</do1:formEditPermissions><do1:actionWithoutHandler>{"transferMode":"enterNextNode"}</do1:actionWithoutHandler></bpmn:extensionElements><bpmn:incoming>obj_06</bpmn:incoming><bpmn:outgoing>obj_07</bpmn:outgoing></bpmn:userTask><bpmn:endEvent id="obj_04" name="结束事件"><bpmn:extensionElements /><bpmn:incoming>obj_07</bpmn:incoming></bpmn:endEvent><bpmn:sequenceFlow id="obj_05" name="" sourceRef="obj_01" targetRef="obj_02"><bpmn:extensionElements /></bpmn:sequenceFlow><bpmn:sequenceFlow id="obj_06" name="" sourceRef="obj_02" targetRef="obj_03"><bpmn:extensionElements /></bpmn:sequenceFlow><bpmn:sequenceFlow id="obj_07" name="" sourceRef="obj_03" targetRef="obj_04"><bpmn:extensionElements /></bpmn:sequenceFlow></bpmn:process><bpmndi:BPMNDiagram id="process_01_di"><bpmndi:BPMNPlane id="process_01_pl"><bpmndi:BPMNShape id="obj_01_di" bpmnElement="obj_01"><dc:Bounds x="2899" y="2701" width="40" height="40" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="obj_02_di" bpmnElement="obj_02"><dc:Bounds x="2864" y="2794" width="110" height="55" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="obj_03_di" bpmnElement="obj_03"><dc:Bounds x="2864" y="2906" width="110" height="55" /></bpmndi:BPMNShape><bpmndi:BPMNShape id="obj_04_di" bpmnElement="obj_04"><dc:Bounds x="2899" y="3012" width="40" height="40" /></bpmndi:BPMNShape><bpmndi:BPMNEdge id="obj_05_di" bpmnElement="obj_05"><di:waypoint x="2919" y="2741" /><di:waypoint x="2919" y="2767.5" /><di:waypoint x="2919" y="2767.5" /><di:waypoint x="2919" y="2794" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="obj_06_di" bpmnElement="obj_06"><di:waypoint x="2919" y="2849" /><di:waypoint x="2919" y="2877.5" /><di:waypoint x="2919" y="2877.5" /><di:waypoint x="2919" y="2906" /></bpmndi:BPMNEdge><bpmndi:BPMNEdge id="obj_07_di" bpmnElement="obj_07"><di:waypoint x="2919" y="2961" /><di:waypoint x="2919" y="2986.5" /><di:waypoint x="2919" y="2986.5" /><di:waypoint x="2919" y="3012" /></bpmndi:BPMNEdge></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>',
          // readonly: true,
          extensions: {
            t: Extension
          },
          filter: ['ServiceTask', 'ReceiveTask', 'TerminateEndEvent'],

          // bpmn样式
          bpmnStyle: {
            StartEvent: {
              fillStyle: { color: '158,202,243' }
            },
            UserTask: {
              content: [
                {
                  actions: [
                    {
                      action: 'font',
                      fontStyle: 'normal',
                      fontVariant: 'normal',
                      fontWeight: 'normal',
                      fontSize: '18px',
                      fontFamily: 'bpmn',
                      fontColor: '#FF884D',
                      content: '\uE844',
                      x: 4,
                      y: 16
                    }
                  ]
                }
              ],
              fillStyle: { color: '158,202,243' }
            }
          },
          // 图形样式
          shapeStyle: [
            { id: 'obj_0g2a3p8', fillStyle: { color: '167,232,210' } }
          ],

          config: {
            select: {
              onSelected: function(element) {
                selectElement = element
              }
            }
          }
        })

        $('.createNode').on('click dragstart', function(e) {
          testBPD.createShape(e, function(element) {
            console.log(element)
          })
          e.preventDefault()
        })

        $('.new').on('click', function(e) {
          testBPD = new BPDCore({
            container: '#canvas',
            // editable: false,
            moddleExtensions: {
              t: Extension
            },
            onShapeEdit: function(shape) {
              console.log(shape)
            },
            onLinkerEdit: function(linker) {
              console.log(linker)
            },
            onSelected: function(element) {
              selectElement = element
            }
          })
        })

        $('.init').on('click', function(e) {
          testBPD.init()
        })

        $('.update').on('click', function(e) {
          testBPD.updateProperties(selectElement.id, {
            original: {
              name: 'test'
            },
            extensions: [
              {
                name: 't:test1',
                value: '测试1'
              },
              {
                name: 't:test2',
                value: '测试2',
                type: 'attr2'
              }
            ]
          })
        })

        $('.toXML').on('click', function(e) {
          testBPD.exportBpmn(function(xml) {
            console.log(xml)
          })
        })

        $('.importXML').on('change', function(e) {
          if (this.files.length) {
            var file = this.files[0]
            if (file) {
              var reader = new FileReader()
              reader.onload = function(e) {
                var result = e.target.result
                testBPD.importBpmn(result, function(e) {
                  console.log(e)
                })
              }
              reader.readAsText(file)
            }
          }
        })

        $('.getFronts').on('click', function() {
          var frontElements = testBPD.getFrontElementsByBpmn(
            selectElement,
            'UserTask'
          )
          console.log(frontElements)
        })

        $('.getFront').on('click', function() {
          var frontElement = testBPD.getFrontElement(selectElement)
          console.log(frontElement)
        })

        $('.destroy').on('click', function() {
          testBPD.destroy()
        })

        $('.multiselect').on('click touchstart', function() {
          testBPD.activateSelect()
        })
      }
    </script>
  </body>
</html>
